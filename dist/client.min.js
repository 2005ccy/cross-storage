function CrossStorageClient(e){var t=document.createElement("a");t.href=e,this._id=CrossStorageClient.generateUUID(),this._origin=t.protocol+"//"+t.host,this._requests={},this._connected=!1,this._count=0,this._installListener(),this._hub=this._createFrame(e)}CrossStorageClient.frameStyle={display:"none",position:"absolute",top:"-999px",left:"-999px"},CrossStorageClient.generateUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,r="x"==e?t:3&t|8;return r.toString(16)})},CrossStorageClient.prototype.onConnect=function(){if(this._connected)return Promise.resolve();var e=this;return new Promise(function(t){e._requests.connect=t})},CrossStorageClient.prototype.set=function(e,t,r){return this._request("set",{key:e,value:t,ttl:r})},CrossStorageClient.prototype.get=function(){var e=Array.prototype.slice.call(arguments);return this._request("get",{keys:e})},CrossStorageClient.prototype.del=function(){var e=Array.prototype.slice.call(arguments);return this._request("del",{keys:e})},CrossStorageClient.prototype._installListener=function(){var e=this,t=function(t){if(t.origin===e._origin&&(e._connected||(e._connected=!0,e._requests.connect&&(e._requests.connect(),delete e._requests.connect)),"ready"!==t.data)){var r=JSON.parse(t.data);r.id&&e._requests[r.id]&&e._requests[r.id](r.error,r.result)}};window.addEventListener?window.addEventListener("message",t,!1):window.attachEvent("onmessage",t)},CrossStorageClient.prototype._createFrame=function(e){var t=window.document.createElement("iframe");for(var r in CrossStorageClient.frameStyle)CrossStorageClient.frameStyle.hasOwnProperty(r)&&(t.style[r]=CrossStorageClient.frameStyle[r]);return window.document.body.appendChild(t),t.src=e,t.contentWindow},CrossStorageClient.prototype._request=function(e,t){var r,n;return n=this,n._count++,r={id:this._id+":"+n._count,method:e,params:t},new Promise(function(e,t){var o=setTimeout(function(){n._requests[r.id]&&(delete n._requests[r.id],t("Timeout: could not perform "+r.method))},3e3);n._requests[r.id]=function(r,n){return clearTimeout(o),r?t(new Error(r)):void e(n)},n._hub.postMessage(JSON.stringify(r),n._origin)})};