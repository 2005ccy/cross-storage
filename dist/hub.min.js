var CrossStorageHub={};CrossStorageHub.init=function(e){window.localStorage&&(CrossStorageHub._permissions=e||[],CrossStorageHub._installListener(),window.parent.postMessage("ready","*"))},CrossStorageHub._installListener=function(){var e=CrossStorageHub._listener;window.addEventListener?window.addEventListener("message",e,!1):window.attachEvent("onmessage",e)},CrossStorageHub._listener=function(e){var r,o,t,s;if("poll"===e.data)return window.parent.postMessage("ready",e.origin);if("ready"!==e.data){if(r=JSON.parse(e.data),CrossStorageHub._permitted(e.origin,r.method))try{t=CrossStorageHub["_"+r.method](r.params)}catch(n){o=n.message}else o="Invalid permissions for "+r.method;s=JSON.stringify({id:r.id,error:o,result:t}),window.parent.postMessage(s,e.origin)}},CrossStorageHub._permitted=function(e,r){var o,t,s,n;if(o=["get","set","del","getKeys"],!CrossStorageHub._inArray(r,o))return!1;for(t=0;t<CrossStorageHub._permissions.length;t++)if(s=CrossStorageHub._permissions[t],s.origin instanceof RegExp&&s.allow instanceof Array&&(n=s.origin.test(e),n&&CrossStorageHub._inArray(r,s.allow)))return!0;return!1},CrossStorageHub._set=function(e){var r,o;if(r=e.ttl,r&&parseInt(r,10)!==r)throw new Error("ttl must be a number");o={value:e.value},r&&(o.expire=CrossStorageHub._now()+r),window.localStorage.setItem(e.key,JSON.stringify(o))},CrossStorageHub._get=function(e){var r,o,t,s,n;for(r=window.localStorage,o=[],t=0;t<e.keys.length;t++)n=e.keys[t],s=JSON.parse(r.getItem(n)),null===s?o.push(null):s.expire&&s.expire<CrossStorageHub._now()?(r.removeItem(n),o.push(null)):o.push(s.value);return o.length>1?o:o[0]},CrossStorageHub._del=function(e){for(var r=0;r<e.keys.length;r++)window.localStorage.removeItem(e.keys[r])},CrossStorageHub._getKeys=function(){var e,r,o;for(o=[],r=window.localStorage.length,e=0;r>e;e++)o.push(window.localStorage.key(e));return o},CrossStorageHub._inArray=function(e,r){for(var o=0;o<r.length;o++)if(e===r[o])return!0;return!1},CrossStorageHub._now=function(){return"function"==typeof Date.now?Date.now():(new Date).getTime()};